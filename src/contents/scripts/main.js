(function() {
  var $, History, PageAnimator,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __slice = [].slice;

  $ = jQuery;

  History = window.History;

  $.fn.extend({
    middleAlign: function(options) {
      return $(window).resize((function(_this) {
        return function() {
          return _this.each(function() {
            var h, wh;
            wh = $('.header-wrap').outerHeight();
            h = $(this).outerHeight();
            if (wh > h) {
              return $(this).css('top', (wh - h) / 2);
            }
          });
        };
      })(this)).resize();
    }
  });

  $('.js-middle-align').middleAlign();

  $.fn.extend({
    maxHeight: function(options) {
      return $(window).resize((function(_this) {
        return function() {
          return _this.each(function() {
            var wh;
            wh = $(window).outerHeight();
            return $(this).css('height', wh);
          });
        };
      })(this)).resize();
    }
  });

  $('.js-max-height').maxHeight();

  $.fn.extend({
    marginTop: function(options) {
      return $(window).resize((function(_this) {
        return function() {
          return _this.each(function() {
            var wh;
            wh = $(window).outerHeight();
            return $(this).css('top', wh);
          });
        };
      })(this)).resize();
    }
  });

  $('.js-margin-top').marginTop();

  $.fn.extend({
    navLinks: function(options) {
      return this.each(function() {
        return $(this).on('click touchstart', 'a', function(e) {
          var newHeight, newTop, top;
          e.preventDefault();
          newHeight = 260;
          top = $('.js-middle-align').css('top');
          newTop = (260 - $('.js-middle-align').outerHeight()) / 2;
          $('.js-middle-align').animate({
            top: newTop
          }, 150);
          return $('.js-max-height').animate({
            height: 260
          }, 150);
        });
      });
    }
  });

  $.fn.extend({
    ajaxLoader: function(options) {
      var binders, currentLevel, getLevel, linkClicked;
      binders = function() {
        return $('[data-history]').on('click touchstart', linkClicked);
      };
      getLevel = function(url) {
        return url.split('/').length - 1;
      };
      linkClicked = function(e) {
        var href, level;
        e.preventDefault();
        href = $(e.currentTarget).attr('href');
        level = getLevel(href);
        return console.log(level);
      };
      currentLevel = getLevel(document.location.pathname);
      console.log(currentLevel);
      return binders();
    }
  });

  PageAnimator = (function() {
    PageAnimator.prototype.defaults = {};

    function PageAnimator(el, options) {
      this.onStateChange = __bind(this.onStateChange, this);
      this.onLinkClicked = __bind(this.onLinkClicked, this);
      this.options = $.extend({}, this.defaults, options);
      this.$el = $(el);
      this.currentLevel = this.getLevel(document.location.pathname);
      this.binders();
    }

    PageAnimator.prototype.binders = function() {
      this.$el.on('click', '[data-pa]', this.onLinkClicked);
      return History.Adapter.bind(window, 'statechange', this.onStateChange);
    };

    PageAnimator.prototype.onLinkClicked = function(e) {
      var href, level, title;
      e.preventDefault();
      href = $(e.currentTarget).attr('href');
      title = $(e.currentTarget).attr('title') + ' - somename';
      level = this.getLevel(href);
      return $.get(href).done(function(data) {
        var content;
        content = $(data).find('#content').html();
        return History.pushState({
          content: content,
          level: level
        }, title, href);
      }).fail(function() {
        return console.log('failed :(');
      });
    };

    PageAnimator.prototype.onStateChange = function() {
      var content, level, state;
      state = History.getState();
      level = state.data.level;
      content = state.data.content;
      if (level == null) {
        return window.location = state.url;
      }
      if (level === this.currentLevel) {
        this.animateSibling(content);
      }
      if (level < this.currentLevel) {
        this.animateBackwards(content);
      }
      if (level > this.currentLevel) {
        this.animateForwards(content);
      }
      return this.currentLevel = level;
    };

    PageAnimator.prototype.animateSibling = function(content) {
      return this.animate(content, 'anim-up', 'anim-down');
    };

    PageAnimator.prototype.animateBackwards = function(content) {
      return this.animate(content, 'anim-left', 'anim-right');
    };

    PageAnimator.prototype.animateForwards = function(content) {
      return this.animate(content, 'anim-right', 'anim-left');
    };

    PageAnimator.prototype.getLevel = function(url) {
      return url.split('/').length - 1 || null;
    };

    PageAnimator.prototype.collapseHeader = function(fn) {
      if ($('.js-max-height').length === 0) {
        return fn();
      }
      $('.js-middle-align').animate({
        top: 0
      }, 150);
      return $('.js-max-height').animate({
        height: 260
      }, 150, function() {
        $(this).removeClass('js-max-height');
        return fn();
      });
    };

    PageAnimator.prototype.animate = function(content, inClass, outClass) {
      return this.collapseHeader(function() {
        var $currentContent, $newContent;
        $newContent = $(content).addClass(inClass);
        $currentContent = $('#content .section-wrap:first');
        $('#content').append($newContent);
        $('#content').css('height', $newContent.outerHeight());
        setTimeout(function() {
          $currentContent.addClass(outClass);
          $newContent.removeClass(inClass);
          return setTimeout(function() {
            $currentContent.remove();
            $('#content').css('min-height', $(window).height() - 60);
            return $('#content').css('height', 'auto');
          }, 500);
        }, 50);
        return $('html, body').animate({
          scrollTop: 204
        }, 150);
      });
    };

    return PageAnimator;

  })();

  $.fn.extend({
    pageAnimator: function() {
      var args, option;
      option = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      return this.each(function() {
        var $this;
        $this = $(this);
        return new PageAnimator(this, {});
      });
    }
  });

  $('body').pageAnimator();

}).call(this);

//# sourceMappingURL=data:application/json;base64,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Q0FBQyxNQUFMLENBQVk7QUFBQSxJQUFBLFlBQUEsRUFBYyxTQUFBLEdBQUE7QUFDeEIsVUFBQSxZQUFBO0FBQUEsTUFEeUIsdUJBQVEsOERBQ2pDLENBQUE7YUFBQSxJQUFDLENBQUEsSUFBRCxDQUFNLFNBQUEsR0FBQTtBQUNKLFlBQUEsS0FBQTtBQUFBLFFBQUEsS0FBQSxHQUFRLENBQUEsQ0FBRSxJQUFGLENBQVIsQ0FBQTtlQUNJLElBQUEsWUFBQSxDQUFhLElBQWIsRUFBbUIsRUFBbkIsRUFGQTtNQUFBLENBQU4sRUFEd0I7SUFBQSxDQUFkO0dBQVosQ0F2S0EsQ0FBQTs7QUFBQSxFQTZLQSxDQUFBLENBQUUsTUFBRixDQUFTLENBQUMsWUFBVixDQUFBLENBN0tBLENBQUE7QUFBQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiJCA9IGpRdWVyeVxuSGlzdG9yeSA9IHdpbmRvdy5IaXN0b3J5XG5cbiQuZm4uZXh0ZW5kXG4gIG1pZGRsZUFsaWduOiAob3B0aW9ucykgLT5cbiAgICByZXR1cm4gJCh3aW5kb3cpLnJlc2l6ZSg9PlxuICAgICAgcmV0dXJuIEBlYWNoICgpLT5cbiAgICAgICAgd2ggPSAkKCcuaGVhZGVyLXdyYXAnKS5vdXRlckhlaWdodCgpXG4gICAgICAgIGggID0gJCh0aGlzKS5vdXRlckhlaWdodCgpXG4gICAgICAgIGlmIHdoID4gaCB0aGVuICQodGhpcykuY3NzKCd0b3AnLCAod2gtaCkgLyAyKVxuICAgICkucmVzaXplKClcblxuJCgnLmpzLW1pZGRsZS1hbGlnbicpLm1pZGRsZUFsaWduKClcblxuJC5mbi5leHRlbmRcbiAgbWF4SGVpZ2h0OiAob3B0aW9ucykgLT5cbiAgICByZXR1cm4gJCh3aW5kb3cpLnJlc2l6ZSg9PlxuICAgICAgcmV0dXJuIEBlYWNoICgpLT5cbiAgICAgICAgd2ggPSAkKHdpbmRvdykub3V0ZXJIZWlnaHQoKVxuICAgICAgICAkKHRoaXMpLmNzcygnaGVpZ2h0Jywgd2gpXG4gICAgKS5yZXNpemUoKVxuXG4kKCcuanMtbWF4LWhlaWdodCcpLm1heEhlaWdodCgpXG5cblxuJC5mbi5leHRlbmRcbiAgbWFyZ2luVG9wOiAob3B0aW9ucykgLT5cbiAgICByZXR1cm4gJCh3aW5kb3cpLnJlc2l6ZSg9PlxuICAgICAgcmV0dXJuIEBlYWNoICgpLT5cbiAgICAgICAgd2ggPSAkKHdpbmRvdykub3V0ZXJIZWlnaHQoKVxuICAgICAgICAkKHRoaXMpLmNzcygndG9wJywgd2gpXG4gICAgKS5yZXNpemUoKVxuXG4kKCcuanMtbWFyZ2luLXRvcCcpLm1hcmdpblRvcCgpXG5cblxuJC5mbi5leHRlbmRcbiAgbmF2TGlua3M6IChvcHRpb25zKSAtPlxuICAgIHJldHVybiBAZWFjaCAoKS0+XG4gICAgICAkKHRoaXMpLm9uKCdjbGljayB0b3VjaHN0YXJ0JywgJ2EnLCAoZSkgLT5cbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgIG5ld0hlaWdodCA9IDI2MFxuICAgICAgICB0b3AgPSAkKCcuanMtbWlkZGxlLWFsaWduJykuY3NzKCd0b3AnKVxuICAgICAgICBuZXdUb3AgPSAoMjYwIC0gJCgnLmpzLW1pZGRsZS1hbGlnbicpLm91dGVySGVpZ2h0KCkpIC8gMlxuICAgICAgICAkKCcuanMtbWlkZGxlLWFsaWduJykuYW5pbWF0ZSh7IHRvcDogbmV3VG9wIH0sIDE1MClcbiAgICAgICAgJCgnLmpzLW1heC1oZWlnaHQnKS5hbmltYXRlKHsgaGVpZ2h0OiAyNjAgfSwgMTUwKVxuICAgICAgKVxuIyAkKCcubWFpbi1uYXYnKS5uYXZMaW5rcygpXG5cbiQuZm4uZXh0ZW5kXG4gIGFqYXhMb2FkZXI6IChvcHRpb25zKSAtPlxuXG4gICAgYmluZGVycyA9IC0+XG4gICAgICAkKCdbZGF0YS1oaXN0b3J5XScpLm9uKCdjbGljayB0b3VjaHN0YXJ0JywgbGlua0NsaWNrZWQpXG5cbiAgICBnZXRMZXZlbCA9ICh1cmwpIC0+IHJldHVybiB1cmwuc3BsaXQoJy8nKS5sZW5ndGggLSAxXG5cbiAgICBsaW5rQ2xpY2tlZCA9IChlKSAtPlxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICBocmVmID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoJ2hyZWYnKVxuICAgICAgbGV2ZWwgPSBnZXRMZXZlbChocmVmKVxuICAgICAgY29uc29sZS5sb2cgbGV2ZWxcblxuXG4gICAgY3VycmVudExldmVsID0gZ2V0TGV2ZWwoZG9jdW1lbnQubG9jYXRpb24ucGF0aG5hbWUpXG4gICAgY29uc29sZS5sb2cgY3VycmVudExldmVsXG4gICAgYmluZGVycygpXG5cbiMgJCgnYm9keScpLmFqYXhMb2FkZXIoKVxuXG5cblxuXG5cblxuIyBQYWdlQW5pbWF0b3IgQ2xhc3NcbmNsYXNzIFBhZ2VBbmltYXRvclxuICBkZWZhdWx0czoge31cblxuICBjb25zdHJ1Y3RvcjogKGVsLCBvcHRpb25zKSAtPlxuICAgIEBvcHRpb25zICAgICAgPSAkLmV4dGVuZCh7fSwgQGRlZmF1bHRzLCBvcHRpb25zKVxuICAgIEAkZWwgICAgICAgICAgPSAkKGVsKVxuICAgIEBjdXJyZW50TGV2ZWwgPSBAZ2V0TGV2ZWwoZG9jdW1lbnQubG9jYXRpb24ucGF0aG5hbWUpXG4gICAgQGJpbmRlcnMoKVxuXG4gIGJpbmRlcnM6IC0+XG4gICAgQCRlbC5vbignY2xpY2snLCAnW2RhdGEtcGFdJywgQG9uTGlua0NsaWNrZWQpXG4gICAgSGlzdG9yeS5BZGFwdGVyLmJpbmQod2luZG93LCAnc3RhdGVjaGFuZ2UnLCBAb25TdGF0ZUNoYW5nZSlcblxuICBvbkxpbmtDbGlja2VkOiAoZSkgPT5cbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICBocmVmICA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKCdocmVmJylcbiAgICB0aXRsZSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKCd0aXRsZScpICsgJyAtIHNvbWVuYW1lJ1xuICAgIGxldmVsID0gQGdldExldmVsKGhyZWYpXG5cbiAgICAkLmdldChocmVmKVxuICAgICAgLmRvbmUoKGRhdGEpIC0+XG4gICAgICAgIGNvbnRlbnQgPSAkKGRhdGEpLmZpbmQoJyNjb250ZW50JykuaHRtbCgpXG5cbiAgICAgICAgSGlzdG9yeS5wdXNoU3RhdGUoeyBjb250ZW50OiBjb250ZW50LCBsZXZlbDogbGV2ZWwgfSwgdGl0bGUsIGhyZWYpXG4gICAgICApXG4gICAgICAuZmFpbCgtPlxuICAgICAgICBjb25zb2xlLmxvZyAnZmFpbGVkIDooJ1xuICAgICAgKVxuXG4gIG9uU3RhdGVDaGFuZ2U6ID0+XG4gICAgc3RhdGUgICA9IEhpc3RvcnkuZ2V0U3RhdGUoKVxuICAgIGxldmVsICAgPSBzdGF0ZS5kYXRhLmxldmVsXG4gICAgY29udGVudCA9IHN0YXRlLmRhdGEuY29udGVudFxuICAgICMgSGlzdG9yeS5sb2coJ3N0YXRlY2hhbmdlOicsIHN0YXRlLmRhdGEsIHN0YXRlLnRpdGxlLCBzdGF0ZS51cmwpXG5cbiAgICB1bmxlc3MgbGV2ZWw/XG4gICAgICByZXR1cm4gd2luZG93LmxvY2F0aW9uID0gc3RhdGUudXJsXG5cbiAgICBpZiBsZXZlbCBpcyBAY3VycmVudExldmVsXG4gICAgICBAYW5pbWF0ZVNpYmxpbmcoY29udGVudClcbiAgICBpZiBsZXZlbCA8IEBjdXJyZW50TGV2ZWxcbiAgICAgIEBhbmltYXRlQmFja3dhcmRzKGNvbnRlbnQpXG4gICAgaWYgbGV2ZWwgPiBAY3VycmVudExldmVsXG4gICAgICBAYW5pbWF0ZUZvcndhcmRzKGNvbnRlbnQpXG5cbiAgICBAY3VycmVudExldmVsID0gbGV2ZWxcblxuICBhbmltYXRlU2libGluZzogKGNvbnRlbnQpIC0+XG4gICAgQGFuaW1hdGUoY29udGVudCwgJ2FuaW0tdXAnLCAnYW5pbS1kb3duJylcblxuICBhbmltYXRlQmFja3dhcmRzOiAoY29udGVudCkgLT5cbiAgICBAYW5pbWF0ZShjb250ZW50LCAnYW5pbS1sZWZ0JywgJ2FuaW0tcmlnaHQnKVxuXG4gIGFuaW1hdGVGb3J3YXJkczogKGNvbnRlbnQpIC0+XG4gICAgQGFuaW1hdGUoY29udGVudCwgJ2FuaW0tcmlnaHQnLCAnYW5pbS1sZWZ0JylcblxuICAjIFByaXZhdGVcbiAgZ2V0TGV2ZWw6ICh1cmwpIC0+IHJldHVybiB1cmwuc3BsaXQoJy8nKS5sZW5ndGggLSAxIHx8IG51bGxcblxuICBjb2xsYXBzZUhlYWRlcjogKGZuKSAtPlxuICAgIGlmICQoJy5qcy1tYXgtaGVpZ2h0JykubGVuZ3RoIGlzIDBcbiAgICAgIHJldHVybiBmbigpXG4gICAgJCgnLmpzLW1pZGRsZS1hbGlnbicpLmFuaW1hdGUodG9wOiAwLCAxNTApXG4gICAgJCgnLmpzLW1heC1oZWlnaHQnKS5hbmltYXRlKGhlaWdodDogMjYwLCAxNTAsIC0+XG4gICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdqcy1tYXgtaGVpZ2h0JylcbiAgICAgIGZuKClcbiAgICApXG5cbiAgYW5pbWF0ZTogKGNvbnRlbnQsIGluQ2xhc3MsIG91dENsYXNzKSAtPlxuICAgIEBjb2xsYXBzZUhlYWRlciAtPlxuICAgICAgJG5ld0NvbnRlbnQgPSAkKGNvbnRlbnQpLmFkZENsYXNzKGluQ2xhc3MpXG4gICAgICAkY3VycmVudENvbnRlbnQgPSAkKCcjY29udGVudCAuc2VjdGlvbi13cmFwOmZpcnN0JylcblxuICAgICAgJCgnI2NvbnRlbnQnKS5hcHBlbmQoJG5ld0NvbnRlbnQpXG4gICAgICAkKCcjY29udGVudCcpLmNzcygnaGVpZ2h0JywgJG5ld0NvbnRlbnQub3V0ZXJIZWlnaHQoKSlcblxuICAgICAgc2V0VGltZW91dCgtPlxuICAgICAgICAkY3VycmVudENvbnRlbnQuYWRkQ2xhc3Mob3V0Q2xhc3MpXG4gICAgICAgICRuZXdDb250ZW50LnJlbW92ZUNsYXNzKGluQ2xhc3MpXG5cbiAgICAgICAgc2V0VGltZW91dCgtPlxuICAgICAgICAgICRjdXJyZW50Q29udGVudC5yZW1vdmUoKVxuICAgICAgICAgICQoJyNjb250ZW50JykuY3NzKCdtaW4taGVpZ2h0JywgJCh3aW5kb3cpLmhlaWdodCgpIC0gNjApXG4gICAgICAgICAgJCgnI2NvbnRlbnQnKS5jc3MoJ2hlaWdodCcsICdhdXRvJylcbiAgICAgICAgLCA1MDApXG4gICAgICAsIDUwKVxuICAgICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoeyBzY3JvbGxUb3A6IDIwNCB9LCAxNTApXG5cblxuXG4jIFBhZ2VBbmltYXRvciBQbHVnaW5cbiQuZm4uZXh0ZW5kIHBhZ2VBbmltYXRvcjogKG9wdGlvbiwgYXJncy4uLikgLT5cbiAgQGVhY2ggLT5cbiAgICAkdGhpcyA9ICQodGhpcylcbiAgICBuZXcgUGFnZUFuaW1hdG9yKHRoaXMsIHt9KVxuXG4jIFBhZ2VBbmltYXRvciBCb290c3RyYXBcbiQoJ2JvZHknKS5wYWdlQW5pbWF0b3IoKSJdfQ==